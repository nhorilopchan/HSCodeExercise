<!-- Filterable Content Block -->
<%include ../partials/_blueheader%>
<%
function getUniqueValues(array, key) {
//	var uniqueYears = new Set();
//	array.forEach(function(item) {
//		if (item.hasOwnProperty(key)) {
//			uniqueYears.add(item[key]);
//		}
//	});
//	return uniqueYears;

	const fullArray = array.reduce((previous, item) => {

	    if(typeof item[key] === "string") {
			console.log(item[key]);
			return [...previous,item[key]];
		}
		else
		{
			return [...previous, ...item[key]];
		}
	}, []);

	return fullArray.reduce((previous, item) => {
		var duplicateGenre = previous.find(prevItem => item === prevItem);
		if (!duplicateGenre) {
			previous.push(item);
		}
		return previous;
	}, []);
}
%>
<section class="filterable-content-block">
	<div class="content-wrapper">
		<div>
			<div class="filters-panel">
				<div class="row first">
					<div class="dropdown by-genre">
						<span class="toggle">Genre</span>
							<div class="dropdown-content">
								<ul id="ddl-by-genre">
									<!-- TODO- FIX THIS -->
									<%
									var uniqueGenres = getUniqueValues(data.media, "genre").sort();
									uniqueGenres.forEach(function (genre,index) {

 									%>
									<li><input type="checkbox" id=<%=`chkGenre${index}`%> class="filter-list"
											   data-filter="genre" value="<%=genre%>"/><label
												for=<%=`chkGenre${index}`%>>
											<%=genre%></label></li>
									<%});%>
								</ul>
							</div>
					</div>
					<div class="dropdown by-year">
						<span class="toggle">Year</span>
						<div class="dropdown-content">

						<ul id="ddl-by-year">
						<% var uniqueYears= getUniqueValues(data.media, "year").sort();
						uniqueYears.forEach(function(year,index) {
                        %>
							<li><input type="checkbox" id=<%=`chkYear${index}`%> class="filter-list" data-filter="year"
									   value="<%=year%>"/><label
										for=`<%=`chkYear${index}`%>><%=
										year%></label></li>
                        <%});%>
						</ul>
						</div>
					</div>
					<div id="search-input" class="search-input">
						<input type="text">
						<ul class="search-list">
                            <% var uniqueTitles= getUniqueValues(data.media, "title");
							uniqueTitles.forEach(function(title) {
                            %>
							<li><a href="#" title="<%=title%>"><%= title%></a></li>
                            <%});%>
						</ul>
					</div>
				</div>
				<div class="row second">
					<div>
						<input type="radio" name="filter-radio">
						<label>Movies</label>
					</div>
					<div>
						<input type="radio" name="filter-radio">
						<label>Books</label>
					</div>
					<div class="clear-filters">
						<a href="#" id="clearfilters">Clear filters</a>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="content-wrapper list-wrapper">
		<div>
			<div>
				<ul class="contents-list">
                    <% data.media.forEach(function(media) {
                    %>
					<li data-year="<%= media.year%>" data-genres="<%= media.genre%>">
						<div class="thumbnail-wrapper">
							<img src="<%= media.poster %>" title="<%= media.title %>" />
						</div>
						<div class="info-wrapper">
							<p class="info-year"><%= media.title %>(<%= media.year%>)</p>
							<p class="info-genre"><%= media.genre%></p>
						</div>
					</li>
                    <% }); %>
				</ul>

			</div>
		</div>
	</div>
</section>